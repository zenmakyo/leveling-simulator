document.addEventListener("DOMContentLoaded", () => {

  /* レベル入力 */
  document.querySelectorAll(".adjustBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      const input = btn.parentElement.querySelector("input[type=number]");
      let value = parseInt(input.value) || 0;
      value += parseInt(btn.dataset.value);
      if (value < 1) value = 1;
      if (value > 250) value = 250;
      input.value = value;
    });
  });

  // 半角数字のみ許可
  function enforceHalfWidthDigits(input) {
    input.addEventListener("input", () => {
      input.value = input.value.replace(/[^0-9]/g, "");
    });
  }

  const currentLevel = document.getElementById("currentLevel");
  const targetLevel = document.getElementById("targetLevel");
  const nextExp = document.getElementById("nextExp");
  [currentLevel, targetLevel, nextExp].forEach(enforceHalfWidthDigits);

  /* 転生数に色付け */
  const rebirth = document.getElementById("rebirth");
  const rebirthColors = {
    "0": "rgba(220, 221, 221, 0.5)",
    "1": "rgba(187, 200, 230, 0.5)",
    "2": "rgba(44, 169, 225, 0.5)",
    "3": "rgba(102, 255, 102, 0.5)",
    "4": "rgba(255, 255, 0, 0.5)",
    "5": "rgba(255, 204, 0, 0.5)",
    "6": "rgba(255, 153, 0, 0.5)",
    "7": "rgba(204, 0, 0, 0.5)",
    "8": "rgba(255, 51, 204, 0.5)",
    "9": "rgba(153, 0, 204, 0.5)"
  };
  rebirth.addEventListener("change", () => {
    rebirth.style.backgroundColor = rebirthColors[rebirth.value] || "#fff";
  });

  /* 討伐対象のみリセット */
document.getElementById("resetTargetBtn").addEventListener("click", () => {
  targetInput.value = "";                   // 入力を空に
  suggestionsBox.style.display = "none";   // 候補を非表示
  document.getElementById("customExpBox").style.display = "none"; // カスタム経験値欄も非表示
});

  /* 強化値・参加枠数表示 */
  const abilityRadios1 = document.querySelectorAll('input[name="ability1"]');
  const abilityRadios2 = document.querySelectorAll('input[name="ability2"]');
  const enhanceBox = document.getElementById("enhanceBox");
  const slotBox = document.getElementById("slotBox");

  function updateOptions() {
    const selected1 = document.querySelector('input[name="ability1"]:checked')?.value;
    const selected2 = document.querySelector('input[name="ability2"]:checked')?.value;
    enhanceBox.style.display = (selected1 === "博識" || selected2 === "博識" || selected1 === "共栄" || selected2 === "共栄") ? "flex" : "none";
    slotBox.style.display = (selected1 === "共栄" || selected2 === "共栄") ? "flex" : "none";
  }

  updateOptions();
  abilityRadios1.forEach(r => r.addEventListener("change", updateOptions));
  abilityRadios2.forEach(r => r.addEventListener("change", updateOptions));

  /* 討伐対象候補 */
  const targetExpTable = {
    "[497] 闇黒龍": 497, "[326] 叛逆の断罪者": 326, "[275] 盲鬼ト浮鬼": 275, "[261] 砂漠の亡者":261, "[250] 終焉の指揮者": 250, "[222] ポセイドン": 222, "[196] 死を告げる者": 196, "[183] 疎まれし者": 183, "[169] 刑罰を記すもの": 169, "[161] ロックイーター": 161,
    "[147] カトブレパス": 147, "[134] 海太郎": 134, "[122] 意思ある肖像": 122, "[106] ウッビィ": 106, "[94] スキュラ": 94, "[78] 鼠小組": 78, "[59] 画匠カミーリオ": 59, "[43] 川太郎": 43, "[29] 魔女の森の梟": 29, "[20] お化け提灯": 20,
    "[7] トゲウサギ": 7, "[5] コブンネズミ": 5,
    "[5] 宝食のミミクル": 5, "[200] グリフォン": 200, "[200] フリームスルス": 200, "[200] ジャッカロープ": 200,
    "[4500] 星詠の天極主（星譚♪星御伽に夢心地）": 4500, "[4444] 狐...？（遊曲♪朱狐と祭囃子）": 4444, "[3333] 急の試練・狐（急の試練）": 3333, "[3000] シルバー・G・ゴーレム（魔導体G.Q/ヒーローバッジ）": 3000, "[2500] ゲンペイボタル（曲名♪あの日見た五光）": 2500,
    "[2500] 玉藻御前（醒曲♪絶世の美狐）": 2500, "[2500] ダークロードノヴァ（醒曲♪騎士道邪心）": 2500, "[2500] 熾天什使（醒曲♪輝く碧き六翼）": 2500, "[2500] 月都之常姫（醒曲♪今は遠き郷月）": 2500, "[2500] ルシファー【覚醒】（醒曲♪堕ちたる明星）": 2500,
    "[2500] 天使長ルシファー（醒曲♪明星の行く末は）": 2500, "[2500] ジャンヌダルク【覚醒】（醒曲♪先導せし聖女）": 2500, "[2500] ジャンヌダルク・イフ（醒曲♪煽動せし魔女）": 2500, "[2500] 鎮守オータムドラゴン（醒曲♪秋季に揺らす恵傘）": 2500, "[2500] 黒麒麟・華天（醒曲♪生起する嘶き）": 2500,
    "[2000] 一反木綿（空飛ぶ白布...？）": 2000, "[1500] 揺蕩う白影（双眼鏡）": 1500, "[1050] 有頂天狐（経験値）（もっちり揚げ袋）": 1050, "[1532] リントヴルム（壊曲♪昊裂く兇翼）": 1532,
    "[800] 夢幻の胡蝶【悪夢】（栩栩然の香）": 800, "[777] おみくじ小町【大吉】（鳥御籤）": 777, "[777] 招福宝船（曲名♪七福宝船）": 777, "[766] ティアマト（壊曲♪壮麗たる巨翼）": 766, "[766] 創造神（曲名♪世界の再生/ヒーローバッジ）": 766, "[750] 黒禍フェンリル（壊曲♪巨狼の激昂）": 750,
    "[735] 強烈な脚技使い（ゴング）": 735, "[735] フェンリル（壊曲♪巨狼の蹂躙）": 735, "[735] バハムート（極星の熱量）": 735, "[735] オキクルミ（曲名♪英雄凍土）": 735, "[735] 焦恋の清姫（曲名♪恋焦ガレ）": 735, "[735] 傾国の妖狐・妲己（曲名♪酒池肉林）": 735,
    "[704] 伊邪那（八百万神集絵巻）": 704, "[704] スセリヒメ（八百万神集絵巻）": 704, "[704] 高闇之淤加美神（八百万神集絵巻）": 704, "[704] アメノウズメ（八百万神集絵巻）": 704, "[704] 天叢雲剣・天羽々斬（八百万神集絵巻）": 704, "[704] 東雲之富慈神（八百万神集絵巻）": 704, "[704] 八坂瓊曲玉（八百万神集絵巻）": 704,
    "[704] 真経津鏡（八百万神集絵巻）": 704, "[704] 大口真神（八百万神集絵巻）": 704, "[704] 天津甕星（八百万神集絵巻）": 704, "[704] 緋翼のアグシャナ（曲名♪幽閉の緋帝）": 704, "[704] ベヒモス（壊曲♪最果ての断崖）": 704, "[704] 百花仙子（曲名♪華やぐ仙女）": 704,
    "[700] ガブリエルを救おう！（天礼水）": 700, "[700] アルタ・テオリカル（幻獣乱舞の儀）": 700, "[700] アルタ・ナインハーツ（幻獣乱舞の儀）": 700, "[700] アルタ・ニ・コヴァン（幻獣乱舞の儀）": 700,
    "[689] 戦嵐ノ影獅子（憤怒ノ鏡）": 689, "[689] ルシファー【真夏】（ONSTAGE！）": 689, "[689] ニーズヘッグ（曲名♪禍根の胎動）": 689,
    "[674] 竜契皇ウィルヘミナ（シャルウィダンス？）": 674, "[674] 乙姫（曲名♪波間仰ぐ姫君）": 674, "[674] 霹靂之狼王（曲名♪稲妻を統べる王）": 674, "[674] 赫轟魔イフリート（曲名♪殲滅業火）": 674, "[674] 南国の女神ペレ（曲名♪燃ゆる島の女神）": 674,
    "[661] レクス・レヴナント（時代の帰還）": 661, "[661] 揺蕩う白影（双眼鏡）": 661, "[661] 一反木綿（空飛ぶ白布...？）": 661, "[661] 歴戦の格闘王（ゴング）": 661,
    "[643] 影獅子（曲名♪闇ノ戦神）": 643, "[643] 座天使（曲名♪見定める翼）": 643, "[643] 月日を追う者（曲名♪日月ヲ喰ム）": 643, "[643] 竜吉公主（曲名♪青鸞闘闕にて）": 643, "[643] フランケンシュタイン（曲名♪マッド・フィート）": 643, "[643] 霊峯之大主（曲名♪地恩の息吹）": 643,
    "[621] 黒魔女レイちゃん（壊曲♪猫の気まぐれ）": 621, "[613] 美術商ジェーン・ドゥ（シャルウィダンス？）": 613, "[613] 黒陸吾（曲名♪明媚な庭にて）": 613, "[613] フレイヤ（曲名♪愛が導くままに）": 613, "[613] 斉天大聖（曲名♪筋斗雲に乗って）": 613, "[609] スカサハ（曲名♪不滅なる影の国）": 609, "[608] エレクトラ（曲名♪慈愛の形）": 608,
    "[595] 揺蕩う白影（双眼鏡）": 595, "[595] 戦神と称される獅子（ゴング）": 595, "[595] ロキ（曲名♪ボクはロキ）": 595, "[595] ロキ【肝試】（曲名♪怨霊パレヱド）": 595,
    "[588] ヴァイシュラヴァナ（曲名♪邪滅の三叉槍）": 588, "[582] 玉姫（曲名♪淡鶯流舞）": 582, "[582] 竜扇陽（曲名♪屠竜之技）": 582, "[582] ベリアル（曲名♪恍惚の礼讃歌）": 582, "[582] タケミカヅチ（曲名♪武雷裂電）": 582,
    "[581] 生ける灼滅の炎（曲名♪天より堕つる火）": 581, "[581] 残虐と噂の出場者（ゴング）": 581, "[581] 時の腐肉喰らい（曲名♪逃れられぬ牙/エイボンの書）": 581, "[581] 千の仔を随えし黒山羊（曲名♪黒き豊穣の女神/エイボンの書）": 581, "[581] 幻月に蔓延りし者（曲名♪未知なる幻夢境）": 581, "[581] 這い寄る混沌（幻獣乱舞の儀）": 581,
    "[581] 渾沌（金印）": 581, "[581] 饕餮（金印）": 581, "[581] 窮奇（金印）": 581, "[581] 難訓（金印）": 581, "[581] 阿（五鈷鈴）": 581, "[581] 吽（五鈷鈴）": 581,
    "[581] メデューサ（ネクタル）": 581, "[581] エウリュアレ（ネクタル）": 581, "[581] ステンノ（ネクタル）": 581, "[581] 壊星神コスモ（幼き原星）": 581, "[581] 創星神コスモ（幼き原星）": 581, "[581] 破壊神（壊曲♪崩落の音）": 581, "[581] 霧邪奇（曲名♪悪意なき邪悪）": 581,
    "[568] エーヌシトルイユ（曲名♪遅れた執着点）": 568, "[567] 羅刹鬼（曲名♪戦刃羅刹）": 567, "[560] アスモデウス（曲名♪悦楽の吐息）": 560,
    "[555] 急の試練・玉藻御前（急の試練）": 555, "[555] 闇に囁く者（曲名♪ユゴスの採掘者/エイボンの書）": 555, "[555] 名状しがたい者（曲名♪黄衣の王/エイボンの書）": 555, "[555] 緑の深淵の女王（曲名♪底知れぬ緑/エイボンの書）": 555, "[555] 星間を駆ける者（曲名♪後星の石笛/エイボンの書）": 555, "[555] 獄星の千年花（曲名♪一千年の開花/エイボンの書）": 555, "[555] 地を穿つ魔（曲名♪狂気の奉仕者/エイボンの書）": 555,
    "[555] 旧支配者の大祭司（幻獣乱舞の儀/エイボンの書）": 555, "[555] 悪路王（結酒樽）": 555, "[555] 熾天使（曲名♪闇を切裂く翼）": 555, "[555] ダークロードナイトメア（曲名♪邪悪なる騎士）": 555, "[555] 玉藻前（曲名♪眩惑の微笑）": 555, "[555] なまはげ（壊曲♪悪い子探し）": 555, "[555] 真夜中の贈呈者（壊曲♪聖夜を壊す者）": 555,
    "[555] 夢魔（曲名♪覚めない嘘）": 555, "[555] アジダハーカ（曲名♪彼方の渇望）": 555, "[555] アルセーヌ・ルパン（曲名♪摩天楼を舞う影）": 555, "[555] 石川五右衛門（曲名♪天下を騒がす煙）": 555, "[555] 紅藍ノ朋（藍の友情結び）": 555, "[555] 翠霊社の大神主（曲名♪鎮護の翠獣）": 555, "[555] 綾取人形師（曲名♪私が欲しいのは）": 555,
    "[551] 急の試練・春陽之神使（急の試練）": 551, "[551] 急の試練・薄明之妖狐（急の試練）": 551, "[551] イワナガヒメ（シャルウィダンス？）": 551, "[551] 白澤（曲名♪通暁の瞳）": 551, "[551] 禍津（曲名♪禊の祓子）": 551, "[551] 霊騎士シルドラント（曲名♪魂の帰還）": 551,
    "[550] シュクレッタ（曲名♪SweetParty!）": 550, "[546] 反魂竜（曲名♪呼び戻す命）": 546, "[542] 閻魔大女将（曲名♪閻魔庁開廷）": 542,
    "[542] 白妙鹿天（曲名♪訪秋黄穂）": 542, "[542] ルシファー（曲名♪光をもたらす者）": 542, "[542] ジャンヌダルク（曲名♪神が導きし剣）": 542, "[542] スケイプドラゴン（曲名♪明冬の兆し）": 542, "[542] 大海嘯の紅殻竜（曲名♪海裂紅甲）": 542, "[542] コノハナサクヤ（曲名♪舞えや咲かせや）": 542,
    "[536] アナト（曲名♪激情径行）": 536, "[529] 願奪の寄星体（曲名♪星が願いし食望）": 529, "[529] 揺蕩う白影（双眼鏡）": 529, "[529] 一反木綿（空飛ぶ白布...？）": 529, "[529] 聖竜（古曲♪聖の喚ぶ声）": 529, "[529] 闇竜（古曲♪闇に轟く咆哮）": 529,
    "[529] アテナ（曲名♪紅の砦陣）": 529, "[529] 荒くれ番長ラウディ（曲名♪喧嘩上等！）": 529, "[529] ガブリエル【闇喰】（曲名♪終末の奏）": 529, "[529] 無頼瓜（曲名♪夏浜の余興）": 529, "[527] 大国主（曲名♪創国への歩み）": 527,
    "[521] アポロンα（曲名♪沈まぬ太陽）": 521, "[521] ヘイムダル（曲名♪虹橋の番人）": 521, "[521] 魔術師マーリン（曲名♪魔術の真髄）": 521, "[521] 金鵄（曲名♪制勝の光芒）": 521,
    "[515] 白兎神（曲名♪良縁月兎）": 515, "[515] 薛茘鬼（曲名♪マジ鬼ごっこ）": 515, "[505] 五十嵐・卍（曲名♪ド派手忍法帖）": 505, "[502] 彩海のシウミゥ（曲名♪ギャル⭐︎MIND）": 502, "[502] 百々目鬼（曲名♪花魁掌中）": 502,
    "[500] メタルゴーレム（魔導体G.Q）": 500, "[500] つちのこ（曲名♪このこなんのこ）": 500, "[500] 幻綴司書アナムネシア（幻獣乱舞の儀）": 500,
    "[499] 戦風の皇女（曲名♪旋風の一矢）": 499, "[497] ハーラグゥ（曲名♪砂塵の白布）": 497, "[496] 牛若丸（曲名♪朱橋に舞う夜燕）": 496, "[494] 甘言に従う者（曲名♪閉した助言）": 494, "[490] バアルゼブル（曲名♪気高き主/バグパクゼリー）": 490, "[490] 宇迦之御魂神（曲名♪穂波と讃頌）": 490,
    "[489] 豪腕振るう竜（ゴング）": 489, "[489] 滅鬼積鬼（曲名♪沙汰の限り）": 489, "[481] ガランドーヴ（曲名♪爬長の調べ）": 481,
    "[476] 神羅の後継者（バグパクゼリー）": 476, "[476] 皇竜（曲名♪永遠の物語）": 476, "[476] 謎掛の悪戯猫（曲名♪奇怪な来訪者）": 476, "[476] 執金剛神（曲名♪輪廻の解説）": 476, "[476] 陽翼神ラー（曲名♪太陽信仰）": 476, "[476] ネイト・トントゥ（曲名♪蒸気と香気）": 476, "[476] 有頂天狐（大金）（もっちり揚げ袋）": 476, "[476] 有頂天狐（欲しいもの）（もっちり揚げ袋）": 476, "[476] クエイクドラゴン（曲名♪ひび割れる大地）": 476,
    "[475] 百花仙子【真夏】（ONSTAGE！）": 475, "[473] パヨカムイ（赤）（赤の霊薬）": 473, "[473] 魔導要塞クレイドル（曲名♪迫り来る轟音）": 473, "[468] ファントム（曲名♪欲望と絶望）": 468, "[463] 導きの魔奏者（曲名♪道化の行進曲）": 463, "[456] 急の試練・玉藻前（急の試練）": 456, "[450] 鬼ヶ臼（曲名♪渾身の餅つき）": 450,
    "[449] キョンシー（曲名♪霊幻道士）": 449, "[449] 怨毒宿せし亡王（曲名♪栄華の毒砂）": 449, "[449] シヴァ（曲名♪再生への破壊）": 449, "[449] 常世の車掌ワダチ（曲名♪境界の案内役）": 449, "[447] 我来也・朧【仮装】（パンプキンポット）": 447, "[447] 染乃撫子（白桃の絵画）": 447,
    "[439] エル・ラドル（曲名♪立塞がる門扉）": 439, "[436] 評論家オズコーン（曲名♪炸裂レビュアー）": 436, "[431] シャイターン（ルシファーのお礼）": 431, "[431] アルテミス（曲名♪見守る月）": 431, "[429] 伏姫（曲名♪牡丹の伝奇）": 429, "[429] クシナダヒメ（曲名♪髪梳きの支）": 429, "[429] 迦陵頻伽（曲名♪麗音舞楽）": 429,
    "[423] シルキー（シャルウィダンス？）": 423, "[423] 王家の末路（曲名♪狡猾な魔神）": 423, "[423] シュバリエディオン（麗人のお礼）": 423, "[423] 孟極（曲名♪温故知新）": 423, "[423] キュベレー（曲名♪絶対服従）": 423, "[423] 薬を作ろう！（薬材の籠）": 423, "[423] アルモ・ワンダラーズ（曲名♪旅の仲間たち）": 423,
    "[420] 雷鳴龍（火龍果の絵画）": 420, "[420] 風陣龍（火龍果の絵画）": 420, "[410] 小雪姫【真夏】（ONSTAGE！）": 410, "[410] ステラ☆ディーヴァ☆夏（ONSTAGE！）": 410, "[410] ステラ☆ディーヴァ☆姫（パンプキンポット）": 410, "[410] 白翼のマーテル（曲名♪幸への冀望）": 410, "[407] 星詠の聖女（曲名♪星繋ぐ物語）": 407, "[400] スサノオ（提子）": 400,
    "[399] 晴朗な明察者（曲名♪急々如律令）": 399, "[398] 裁きを下す者（曲名♪死の旋律）": 398, "[397] ノーム【南国】（ONSTAGE！）": 397, "[397] ハラペコリクス（時代の帰還）": 397, "[397] 揺蕩う白影（双眼鏡）": 397, "[397] 一反木綿（空飛ぶ白布...？）": 397, "[397] 牛魔神（曲名♪筋骨隆々）": 397, "[395] オキクムシ（バグパクゼリー）": 395, "[391] ぬらりひょん【狂宴】（幻獣乱舞の儀）": 391,
    "[386] ヴィシュヌ（曲名♪治世の英雄）": 386, "[386] イシス（曲名♪古代の魔術妃）": 386, "[386] ガルーダ（曲名♪熱旋風）": 386, "[383] 急の試練・濡髪童子（急の試練）": 383, "[383] 濡髪童子（曲名♪雨露遊び）": 383,
    "[378] ファーミュ（曲名♪森の揺籃歌）": 378, "[378] ルーガルー（曲名♪望月の悲歎）": 378, "[378] 薬湯殿ゆ屋（曲名♪いい湯だな）": 378, "[376] 星ノ位・射手（星譚♪天翔ける一矢）": 376, "[375] 阿【真似】（曲名♪始まりの雷響）": 375, "[375] 吽【真似】（終わりの疾風）": 375, "[375] ドン・ムグラ（曲名♪成金の野望）": 375, "[373] グレモリー（曲名♪金の蜜告）": 373,
    "[370] 雷舞を極めし翁（シャルウィダンス？）": 370, "[370] エレシュキガル（曲名♪Yes,My lady）": 370, "[370] 小雪姫（曲名♪雪の降る日）": 370, "[370] リャナンシー（曲名♪虜の貴方と私）": 370, "[370] ヴァンピール（曲名♪真祖の品格）": 370, "[370] 双生の群夜灯（曲名♪二翅一対）": 370, "[370] イーリス（曲名♪淑女の微笑）": 370, "[370] ケライノー（曲名♪降り立つ麗風）": 370, "[370] ハルモニア（曲名♪癒しの麗奏）": 370, "[370] 鈴鹿御前（曲名♪佳容討鬼）": 370, 
    "[369] 薄幸佳人【微妙かも】（幻獣乱舞の儀）": 369, "[366] 星ノ位・蠍（星譚♪仄照らす天蠍）": 366, "[366] 星ノ位・獅子（星譚♪聖獣の咆哮）": 366, "[365] ネフティス（曲名♪幽界の守護妃）": 365, "[362] 瘴谷の邪竜（曲名♪毒竜の腮）": 362,
    "[357] クラーケン（曲名♪絡みつく好奇）": 357, "[357] パウチカムイ（曲名♪香りの誘引）": 357, "[357] 濡髪童子【幼姿】（曲名♪あじさい遊び）": 357, "[352] 祝膳女将【絶品】（幻獣乱舞の儀）": 352, "[350] 柚子あひる【増】（溢れ柚子）": 350,
    "[346] 冬将軍ユキムネ【常夏】（曲名♪常夏の将軍/ONSTAGE！）": 346, "[344] 小柄な力士（ゴング）": 344, "[344] ミヅハノメ（曲名♪水明の小花）": 344, "[344] おちゃめ天使・結（曲名♪運命の悪戯）": 344, "[344] 亡霊船フリゲート（曲名♪YO-HO!）": 344, "[344] イセキモリ（曲名♪琥珀色の鳴動）": 344,
    "[331] アフロディーテ（ヒーローバッジ）": 331, "[331] ベルゼブル（曲名♪姫君の願い/バグパクゼリー）": 331, "[331] 星ノ位・乙女（星譚♪見届けし星霜）": 331, "[331] ファラク（曲名♪全ての底）": 331, "[331] パッチワークドラゴン（曲名♪綿布の縫合）": 331,
    "[325] おみくじ小町【吉】（鳥御籤）": 325, "[325] 星ノ位・双子（星譚♪寄り添う星々）": 325, "[323] パウチカムイ【南国】（ONSTAGE！）": 323, "[323] 高雅たる詠人（曲名♪雅遊倭吟）": 323,
    "[317] 難儀鳥【仮装】（パンプキンポット）": 317, "[317] 鋭爪の荒くれ者（ゴング）": 317, "[317] 分福茶釜（シャルウィダンス？）": 317, "[317] ルドラ（曲名♪豪雨の禊）": 317, "[317] 紫怨万代朧車（曲名♪常世への旅路）": 317,
    "[307] バーゲスト【仮装】（パンプキンポット）": 307, "[307] 御使い（曲名♪駆ける吉兆）": 307, "[307] ノーム（曲名♪眠り落ちた地）": 307, "[304] スキムドラゴン（緋丸の劇薬）": 304, "[300] ゴールド・G・ゴーレム（魔導体G.Q/ヒーローバッジ）": 300,
    "[298] 仙渓の杜氏（火龍果の絵画）": 298, "[297] 地を穿つ魔（曲名♪狂喜の熱板/ONSTAGE！）": 297, "[297] エクチュアフ（贄の祀面）": 297, "[296] 急の試練・葛之葉姫（急の試練）": 296, "[296] 蜃（縹色アサリ）": 296, "[296] 題名『画仙』（曲名♪四季の招き手）": 296, "[296] のっぺらぼう・正（幻獣乱舞の儀）": 296, "[294] キョンシー【応援】（曲名♪鼓舞来来）": 294, "[291] 狢【仮装】（パンプキンポット）": 291, "[291] 烏天狗（曲名♪翼を広げて）": 291,
    "[287] 星ノ位・水瓶（星譚♪満ちし宝瓶）": 287, "[286] 水母娘娘（声援筒）": 286, "[285] 高潔なる選定者（幻獣乱舞の儀）": 285, "[284] コルニカ【真似】（曲名♪遊宴の氷界）": 284, "[280] 花蟷フルルテス（バグパクゼリー）": 280, "[280] 壬寅（曲名♪虎尾踏む勿れ）": 280,
    "[278] 時を統べる者【真似】（曲名♪旋律の刻）": 278, "[278] 呪亀【漂白】（曲名♪もしもし香愛よ）": 278, "[278] ヤツフサ【学園】（曲名♪橙の軌跡）": 278, "[278] 点睛を欠く画龍（曲名♪欠けし眼光）": 278, "[278] 道を外れし者（曲名♪とおりゃんせ）": 278, "[278] 晴天狐（曲名♪遠路晴々）": 278, "[273] 狩人（曲名♪抵抗の選択）": 273, "[272] 冬将軍ユキムネ（曲名♪寒波強襲）": 272,
    "[265] 急の試練・萌芽白狐（急の試練）": 265, "[265] 急の試練・小夜黒狐（急の試練）": 265, "[265] オトリコガネ（バグパクゼリー）": 265, "[265] 揺蕩う白影（双眼鏡）": 265, "[265] 一反木綿（空飛ぶ白布...？）": 265, "[265] ジン（曲名♪風神招来）": 265, "[265] タナトス（曲名♪寄り添う影）": 265, "[265] 猿飛（曲名♪雲隠之術）": 265, "[265] ドルチェ（曲名♪純真の花音）": 265, "[265] 小結きんたろう（曲名♪発気揚々）": 265,
    "[262] デスコーピオン（曲名♪ポイズン）": 262, "[262] 海御前（曲名♪諸行無常の仇）": 262, "[262] 幻惑師・藍丸（曲名♪友を追いかけて）": 262, "[261] 獣王（曲名♪森の支配者）": 261, "[261] 狂楽に導く影（呪曲♪あそぼう）": 261, "[261] ベロニカの乙女（曲名♪確固たる名誉）": 261, "[261] 食い倒れ大波（声援筒）": 261, "[261] 道を外れし者【弟子】（巫蟲之匣）": 261, "[260] タンクドラゴン【真似】（曲名♪子守の健啖家）": 260,
    "[259] 夏を連出す淑女（パンプキンポット）": 259, "[259] 天女海月（曲名♪浮遊する心）": 259, "[259] 海幽魚ガッツゥーヲ（擬餌針）": 259, "[256] 疎まれし者【漂流】（曲名♪流れ着く孤島/ONSTAGE！）": 256, "[256] パンドラ【真夏】（曲名♪避暑地を求めて/ONSTAGE！）": 256, "[256] 憎悪撒く怨念（地縛怨輪）": 256, "[256] シャノワール【真似】（曲名♪瞳の鈴音）": 256, "[256] ポセイドン【化粧】（曲名♪波のつづみ）": 256, "[256] 盲鬼ト浮鬼（蜜柑の絵画）": 256,
    "[251] カラフラウム（曲名♪子連れて）": 251, "[251] 不知火（曲名♪暗器の使い手）": 251, "[251] 紅酒のポジョン（曲名♪豊秋に乾杯）": 251, "[250] 鋼鉄オオヒラタ（バグパクゼリー）": 250,
    "[249] 天空鯨（曲名♪天雲の勇魚）": 249, "[249] 天真娘メイメイ（幻獣乱舞の儀）": 249, "[246] ジン【真夏】（ONSTAGE！）": 246, "[246] タンクドラゴン（青汁）": 246, "[244] フェダーイン（幻獣乱舞の儀）": 244, "[241] 急の試練・獣神（急の試練）": 241,
    "[239] ココペリ（曲名♪音色の行き先）": 239, "[238] 女郎蜘蛛【仮装】（パンプキンポット）": 238, "[238] 柚子あひる【並】（溢れ柚子）": 238, "[238] 柚子あひる【金】（溢れ柚子）": 238, "[238] 射的（曲名♪打ち落とせ！）": 238, "[235] パヨカムイ（青）（青の霊薬）": 235, "[235] 水母娘娘（曲名♪潤いし水壺）": 235,
    "[229] 高貴な洒落卵（幻獣乱舞の儀/白桃の絵画）": 229, "[228] 魔王（曲名♪魔を極めし者）": 228, "[225] 神羅の後継者の傍役（傍役の物語）": 225, "[225] 薛茘鬼の傍役（傍役の物語・弐）": 225, "[225] グリムメアの傍役（傍役の物語・参）": 225, "[225] 召喚師テオの傍役（傍役の物語・参）": 225, "[225] スケイジー（バグパクゼリー）": 225, "[225] 激浪の略奪者（曲名♪波間の襲撃）": 225, "[225] 悪路王・郭（曲名♪剣戟の痕跡）": 225,
    "[224] テティス（曲名♪海との戯れ）": 224, "[224] ジャックランタン（幻獣乱舞の儀）": 224, "[220] 夢路の蟲術師（栩栩然の香）": 220,
    "[218] 鵺（曲名♪鵺の鳴く夜）": 218, "[214] ヘル（曲名♪生還の条件）": 214, "[213] 神秘占・悪魔（曲名♪悪徳の囁き）": 213, "[213] 神秘占・星（曲名♪占星の閃き）": 213, "[211] 夜色の番竜（曲名♪夜の境界線）": 211,
    "[209] ヒデリガミ【熱波】（ONSTAGE！）": 209, "[207] 虹色の番竜（曲名♪虹の向こう）": 207, "[206] ツドイガイ（縹色アサリ）": 206, "[206] 探偵ショルメ（曲名♪導かれる解）": 206, "[206] ファットドラゴン（肥満の元）": 206, "[200] おみくじ小町【凶】（鳥御籤）": 200, "[200] デーモンローズ（曲名♪薔薇の円舞曲）": 200,
    "[199] ノームの傍役（傍役の物語・参）": 199, "[199] アプサラス（曲名♪誘いの水踊）": 199, "[199] 甘殻ヤドコロネ（白桃の絵画）": 199, "[197] 女郎蜘蛛【仮装】（曲名♪ラム酒に酔って）": 197, "[197] シルフィード【真似】（曲名♪遊戯の風）": 197, "[196] テティス【純白】（曲名♪幸せな戯れ）": 196, "[196] ドラグーン（曲名♪竜族の末裔）": 196, "[196] バステト（曲名♪気まぐれ熱情）": 196, "[193] 急の試練・妲己（急の試練）": 193, "[193] ミヅハノメ【学園】（曲名♪忘れ物を君に）": 193, "[193] 闇の狂信者（曲名♪湾曲した信仰）": 193, "[193] ヒデリガミ（曲名♪日差し日和）": 193,
    "[189] シャムシード（曲名♪刃音の徘徊）": 189, "[189] スカディ【晴着】（曲名♪瑞花の宴）": 189, "[187] リリス（曲名♪私は貴方の豚）": 187, "[187] 火鼠（幻獣乱舞の儀）": 187, "[185] 氷灯の隠者（曲名♪氷上の標）": 185, "[185] シルキー【闇喰】（曲名♪黒蝕白布）": 185, "[184] アルマド【仮装】（パンプキンポット）": 184, "[183] 呼福童（蜜柑の絵画/幻獣乱舞の儀）": 183, "[180] スケイジー（幻獣乱舞の儀）": 180, "[180] 丙申（曲名♪見聞せず言わず）": 180,
    "[177] ヘビードラゴン（曲名♪過食の暴竜）": 177, "[177] 明狐（曲名♪破の試練・白）": 177, "[177] 宵狐（曲名♪破の試練・黒）": 177, "[177] ほろ酔いあかなめ（遊曲♪祝宴の杯）": 177, "[174] 八咫烏（幻獣乱舞の儀）": 174, "[172] 錬金術師ソフィアの傍役（傍役の物語・弐）": 172, "[170] にゃぶぎょう（曲名♪手出し無用）": 170,
    "[163] 火車（曲名♪枕元の火花）": 163, "[163] 星跳のティアミ（幻獣乱舞の儀/葡萄の絵画）": 163, "[163] 赤い頭巾の娘・悲（曲名♪傷心の選択）": 163, "[163] バーゲスト【仮装】（曲名♪甘味も悪戯も）": 163, "[162] ハルピュイア【真夏】（ONSTAGE！）": 162,
    "[159] 急の試練・九尾（急の試練）": 159, "[159] 悲嘆せし怨念（地縛怨輪）": 159, "[159] 花娘のご飯会（遊曲♪お手製カレー）": 159, "[154] 木霊里（曲名♪霊樹の嘱目）": 154, "[152] 人形劇団ファンタズマ（白桃の絵画）": 152, "[151] ペリタマ（蜜柑の絵画/幻獣乱舞の儀）": 151, "[150] 白猪坊（小さなしおり）": 150, "[150] アルピィ（小さなしおり）": 150, "[150] コトノハミ（小さなしおり）": 150, "[150] 遅咲蝶（バグパクゼリー）": 150,
    "[147] クリームまみれな幻獣（獣）（クリームパイ）": 147, "[147] クリームまみれな幻獣（魔）（クリームパイ）": 147, "[147] クリームまみれな幻獣（霊）（クリームパイ）": 147, "[147] クリームまみれな幻獣（無）（クリームパイ）": 147, "[147] クリームまみれな幻獣（地）（クリームパイ）": 147, "[147] クリームまみれな幻獣（龍）（クリームパイ）": 147, "[142] ナイトメア・滅（曲名♪夢を見た後に）": 142,
    "[138] ストラプト（時代の帰還）": 138, "[137] ガネーシャ（幻獣乱舞の儀/林檎の絵画）": 137, "[133] スカディの傍役（傍役の物語）": 133, "[133] 謎掛の悪戯猫の傍役（傍役の物語）": 133, "[133] 甘言に従う者の傍役（傍役の物語・弐）": 133, "[133] 揺蕩う白影（双眼鏡）": 133, "[133] 一反木綿（空飛ぶ白布...？）": 133, "[133] 赤い頭巾の娘・幸【劇】（曲名♪夢への幕開け）": 133, "[130] パヨカムイ（緑）（緑の霊薬）": 130, "[130] 刑罰鼠車（曲名♪朱獄行き）": 130,
    "[127] カラマリン（時代の帰還）": 127, "[124] 夢幻の胡蝶【正夢】（栩栩然の香）": 124,
    "[119] 星ノ位・天秤の傍役（傍役の物語）": 119, "[118] グレートオックス（曲名♪怒れる猛獣）": 118, "[118] リア獣【聖夜】（曲名♪恋する聖夜）": 118, "[118] 悪意ある支援者（手旗/応援筒）": 118, "[118] ウシャマル（幻獣乱舞の儀）": 118, "[117] リア獣【七夕】（曲名♪恋の星空）": 117, "[116] 空虚なる怨念（地縛怨輪）": 116, "[116] 憤慨するタウマース（幻獣乱舞の儀）": 116, "[116] グリモワール（幻獣乱舞の儀）": 116, "[112] フラッグペリタマ（遊曲♪旗を求めて）": 112, "[112] コスモ（逢魔の刻/イベント）": 112, "[110] 一言主（幻獣乱舞の儀式/林檎の絵画）": 110,
    "[106] 川太郎（林檎の絵画）": 106, "[106] キーウィ（幻獣乱舞の儀/蜜柑の絵画）": 106, "[105] 獏【南国】（ONSTAGE！）": 105, "[103] カリプモリ【学園】（曲名♪押忍！花道）": 103, "[100] 双花蝶（遊曲♪花合わせ）": 100, "[100] 猫の使い魔（曲名♪幣を持って）": 100, "[100] 狐の使い魔（曲名♪箒を持って）": 100, "[100] 反魂竜【幼体】（対魔の閃光）": 100, "[100] ヘイケボタル（遊曲♪こいこい）": 100,
    "[98] てる坊主（幻獣乱舞の儀/林檎の絵画）": 98, "[96] 獅子丸・荒（真実ノ鏡）": 96, "[96] 獅子丸・護（千里ノ鏡）": 96, "[96] ふにゃ渡し（幻獣乱舞の儀/蜜柑の絵画）": 96, "[94] 森の精霊（曲名♪精霊とわたし）": 94, "[92] 幼凶（八卦印）": 92, "[92] 狛犬「阿吽」（封札の咬縄）": 92, "[92] 妖蛇「ゴーゴン」（キビシス）": 92, "[92] 浜辺の鼠小組（曲名♪炎天下の逃走劇）": 92, "[90] ハマガイ（縹色アサリ）": 90,
    "[83] 海竜（曲名♪海へいこうよ）": 83, "[81] マミー（曲名♪蘇る恐怖）": 81, "[80] 夢幻の胡蝶【吉夢】（栩栩然の香）": 80, "[80] ケロペン先生（幻獣乱舞の儀）": 80, "[80] あくろおう（柊木）": 80,
    "[79] 苦悶する怨念（地縛怨輪）": 79, "[74] ポルテポ（ONSTAGE！）": 74, "[66] ゴーレム（曲名♪試験体）": 66, "[53] ベビードラゴン（曲名♪小さき強者）": 53,
    "[35] 幼き亡霊（曲名♪深夜背後に）": 35, "[33] ケットシー・魔（曲名♪いたずら好き）": 33, "[29] 隠神刑部（曲名♪森の若大将）": 29, "[10] ゴールデンゴーレム（魔導体G.Q）": 10
  };
  const wordList = ["カスタム経験値", ...Object.keys(targetExpTable)];
  const targetInput = document.getElementById("targetInput");
  const suggestionsBox = document.querySelector(".targetSuggestions");

  function updateSuggestions() {
    const value = targetInput.value.trim().toLowerCase();
    const matches = value === "" ? wordList : wordList.filter(w => w.toLowerCase().includes(value));
    suggestionsBox.innerHTML = "";
    if (matches.length > 0) {
      matches.forEach(word => {
        const div = document.createElement("div");
        div.textContent = word;
        div.addEventListener("mousedown", () => {
        targetInput.value = word;
        suggestionsBox.style.display = "none";

  // 「カスタム経験値」選択時のみ表示
  if (word === "カスタム経験値") {
    document.getElementById("customExpBox").style.display = "block";
  } else {
    document.getElementById("customExpBox").style.display = "none";
  }
});
        suggestionsBox.appendChild(div);
      });
      suggestionsBox.style.display = "block";
    } else {
      suggestionsBox.style.display = "none";
    }
  }

  targetInput.addEventListener("input", updateSuggestions);
  targetInput.addEventListener("focus", updateSuggestions);
  targetInput.addEventListener("blur", () => setTimeout(() => { suggestionsBox.style.display = "none"; }, 100));

  /* 総必要経験値計算 */
  function calcTotalExp(currentLv, targetLv, rebirth, nextExp) {
    if (currentLv >= targetLv) return 0;
    let total = nextExp;
    for (let lv = currentLv + 1; lv <= targetLv - 1; lv++) {
      total += lv * (11 + rebirth) - 3;
    }
    return total;
  }

  /* 討伐一回あたりの経験値 */
  function calcExpPerBattle(targetExp, itemMultiplier, ability1, ability2, enhanceValue, slotValue, boostMultiplier) {
    function abilityMultiplier(val) {
      switch(val){
        case "習熟/記念": return 10;
        case "博識": return enhanceValue;
        case "早熟": return 30;
        case "共栄": return Math.floor(enhanceValue * slotValue);
        default: return 0;
      }
    }
    const totalPercent = abilityMultiplier(ability1) + abilityMultiplier(ability2);
    return Math.ceil(targetExp * itemMultiplier * (1 + totalPercent / 100) * boostMultiplier);
  }

  /* ブーストボタンのオンオフ */
  const boostRadios = document.querySelectorAll('input[name="boost"]');

boostRadios.forEach(radio => {
  radio.addEventListener("click", () => {
    if (radio.wasChecked) {
      radio.checked = false; // もう一度押したら解除
    }
    boostRadios.forEach(r => r.wasChecked = r.checked); // 状態を更新
  });
});

  /* 計算・表示 */
  document.getElementById("calcBtn").addEventListener("click", () => {
    const curLv = parseInt(currentLevel.value) || 1;
    const tarLv = parseInt(targetLevel.value) || 1;
    const next = parseInt(nextExp.value) || 0;
    const reb = parseInt(rebirth.value) || 0;
    let targetExp;
      if (targetInput.value === "カスタム経験値") {
        targetExp = parseInt(document.getElementById("customExpInput").value) || 0;
      } else {
        targetExp = targetExpTable[targetInput.value] || 0;
      }
    const itemMultiplier = parseInt(document.querySelector('input[name="item"]:checked')?.value) || 1;
    const ability1 = document.querySelector('input[name="ability1"]:checked')?.value || "none";
    const ability2 = document.querySelector('input[name="ability2"]:checked')?.value || "none";
    const enhanceVal = parseInt(document.getElementById("enhanceValue").value) || 0;
    const slotVal = parseFloat(document.getElementById("slotValue").value) || 1;
    const boostMultiplier = parseFloat(document.querySelector('input[name="boost"]:checked')?.value) || 1;

    const totalExpNeeded = calcTotalExp(curLv, tarLv, reb, next);
    const expPerBattle = calcExpPerBattle(targetExp, itemMultiplier, ability1, ability2, enhanceVal, slotVal, boostMultiplier);

    const numBattles = Math.ceil(totalExpNeeded / expPerBattle);
    const obtainedExp = numBattles * expPerBattle;
    const fraction = obtainedExp - totalExpNeeded;

    const targetLevelNext = tarLv * (11 + reb) - 3;
    const remainingNext = targetLevelNext - fraction;

    // 討伐回数に応じて必要コイン数を計算（1コインで5回討伐可能として切り上げ）
    const totalCoins = Math.ceil(numBattles / 5);

   /* 警告・Next計算 */
const fractionWarning = document.getElementById("fractionWarning");
const resultNext = document.getElementById("resultNext");
let displayLevel = tarLv;
let remainExp = tarLv * (11 + reb) - 3 - fraction; // 目標レベルNext - 端数

if (remainExp >= 0) {
  // --- 通常時 ---
  resultNext.style.display = "block";
  document.getElementById("nextExpDisplay").textContent = remainExp;
  fractionWarning.style.display = "none";
} else {
  // --- 超過時 ---
  resultNext.style.display = "none";

  let overExp = remainExp; // 負の値
  while (overExp < 0) {
    displayLevel++;
    const nextForLevel = displayLevel * (11 + reb) - 3;
    overExp += nextForLevel;
  }

  fractionWarning.style.display = "block";
  fractionWarning.innerHTML = `
    ※ 目標レベルを超えてレベルアップします<br>
    推定Lv ${displayLevel} , Next ${overExp} Exp
  `;
}

    // 結果表示
    document.getElementById("resultBox").style.display = "block";
    document.getElementById("currentLvDisplay").textContent = curLv;
    document.getElementById("targetLvDisplay").textContent = tarLv;
    document.getElementById("numBattlesDisplay").textContent = numBattles;
    document.getElementById("coinDisplay").textContent = totalCoins;
    document.getElementById("result").style.display = "none";
  });

  /* リセットボタン */
  document.getElementById("resetBtn").addEventListener("click", () => {
    currentLevel.value = 1;
    targetLevel.value = 1;
    nextExp.value = 0;
    rebirth.value = 0;
    rebirth.style.backgroundColor = rebirthColors["0"];

    // アイテムは「章なし」を選択
    document.querySelectorAll('input[name="item"]').forEach(r => r.checked = r.value === "1");

    // アビリティは「なしなし」を選択
    document.querySelectorAll('input[name="ability1"]').forEach(r => r.checked = r.value === "none");
    document.querySelectorAll('input[name="ability2"]').forEach(r => r.checked = r.value === "none");

    // 強化値・参加枠数初期値
    document.getElementById("enhanceValue").value = 20;
    document.getElementById("slotValue").value = "2.5"; // 4枠と一致させる

    // ブースト解除
    document.querySelectorAll('input[name="boost"]').forEach(r => r.checked = false);

    // 討伐対象の入力欄をクリア
    targetInput.value = "";
    
    // 計算結果非表示
    document.getElementById("resultBox").style.display = "none";
    fractionWarning.style.display = "none";
    document.getElementById("result").style.display = "block"; // リセット時に再表示
    document.getElementById("result").textContent = "ここに結果が表示されます";

    updateOptions(); // アビリティ選択後の表示更新
  });

});
